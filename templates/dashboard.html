{% extends "base.html" %}
{% block title %}Dashboard - Mobile Shop Manager{% endblock %}

{% block extra_css %}
<style>
    .quick-action-btn {
        transition: all 0.3s ease;
        text-decoration: none;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .quick-action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        text-decoration: none;
    }
    
    .quick-action-btn i {
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
    }
    
    .quick-action-btn span {
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }
    
    .tool-btn {
        transition: all 0.3s ease;
        border-radius: 8px;
        font-weight: 500;
    }
    
    .tool-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }
    
    .summary-card {
        border-radius: 15px;
        border: none;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        transition: all 0.3s ease;
        overflow: hidden;
    }
    
    .summary-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 35px rgba(0, 0, 0, 0.2);
    }
    
    .summary-card .card-body {
        padding: 1.5rem;
    }
    
    .summary-card h4 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    .summary-card p {
        font-size: 1.1rem;
        font-weight: 500;
        margin-bottom: 0;
        opacity: 0.95;
    }
    
    .summary-card i {
        filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.3));
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="mb-0">
                <i class="fas fa-tachometer-alt text-primary me-2"></i>
                Dashboard
            </h1>
            <p class="text-muted">Welcome back! Here's your inventory overview.</p>
        </div>
    </div>

    <!-- Summary Cards -->
    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="card text-white h-100 summary-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                <div class="card-body text-center">
                    <i class="fas fa-boxes fa-2x mb-2 text-white"></i>
                    <h4 class="mb-1 text-white fw-bold">{{ total_devices_purchased }}</h4>
                    <p class="mb-0 text-white">Total Purchased</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white h-100 summary-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                <div class="card-body text-center">
                    <i class="fas fa-shopping-cart fa-2x mb-2 text-white"></i>
                    <h4 class="mb-1 text-white fw-bold">{{ total_devices_sold }}</h4>
                    <p class="mb-0 text-white">Total Sold</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white h-100 summary-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                <div class="card-body text-center">
                    <i class="fas fa-mobile-alt fa-2x mb-2 text-white"></i>
                    <h4 class="mb-1 text-white fw-bold">{{ available_devices }}</h4>
                    <p class="mb-0 text-white">Available Devices</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white h-100 summary-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                <div class="card-body text-center">
                    <i class="fas fa-chart-line fa-2x mb-2 text-white"></i>
                    <h4 class="mb-1 text-white fw-bold">View Profits</h4>
                    <p class="mb-0 text-white">(Password Protected)</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-bolt me-2"></i>
                        Quick Actions
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-2 col-lg-2">
                            <a href="{{ url_for('inventory') }}" class="btn btn-outline-primary w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3 quick-action-btn" style="background-color: #6f42c1; border-color: #6f42c1; color: white;">
                                <i class="fas fa-boxes fa-2x mb-2" style="color: white;"></i>
                                <span style="color: white; font-weight: bold; font-size: 0.9rem;">View Inventory</span>
                            </a>
                        </div>
                        <div class="col-md-2 col-lg-2">
                            <a href="{{ url_for('inventory_type') }}" class="btn btn-primary w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3 quick-action-btn" style="background-color: #0d6efd; border-color: #0d6efd; color: white;">
                                <i class="fas fa-plus-circle fa-2x mb-2" style="color: white;"></i>
                                <span style="color: white; font-weight: bold; font-size: 0.9rem;">New Purchase</span>
                            </a>
                        </div>
                        <div class="col-md-2 col-lg-2">
                            <a href="{{ url_for('sale_module') }}" class="btn btn-success w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3 quick-action-btn" style="background-color: #198754; border-color: #198754; color: white;">
                                <i class="fas fa-shopping-cart fa-2x mb-2" style="color: white;"></i>
                                <span style="color: white; font-weight: bold; font-size: 0.9rem;">Make Sale</span>
                            </a>
                        </div>
                        <div class="col-md-3 col-lg-3">
                            <a href="{{ url_for('profits') }}" class="btn btn-warning w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3 quick-action-btn" style="background-color: #fd7e14; border-color: #fd7e14; color: white;">
                                <i class="fas fa-chart-line fa-2x mb-2" style="color: white;"></i>
                                <span style="color: white; font-weight: bold; font-size: 0.9rem;">View Profits</span>
                                <small style="color: white; font-weight: bold; font-size: 0.8rem;">(Protected)</small>
                            </a>
                        </div>
                        <div class="col-md-3 col-lg-3">
                            <a href="{{ url_for('transactions') }}" class="btn btn-info w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3 quick-action-btn" style="background-color: #0dcaf0; border-color: #0dcaf0; color: white;">
                                <i class="fas fa-history fa-2x mb-2" style="color: white;"></i>
                                <span style="color: white; font-weight: bold; font-size: 0.9rem;">View Ledger</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="row">
        <!-- Recent Sales -->
        <div class="col-md-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-shopping-cart me-2"></i>
                        Recent Sales
                    </h5>
                </div>
                <div class="card-body">
                    {% if recent_sales %}
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead class="table-light">
                                <tr>
                                    <th>Date</th>
                                    <th>Device</th>
                                    <th>Price</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for sale in recent_sales %}
                                <tr>
                                    <td>{{ sale.date.strftime('%d/%m') }}</td>
                                    <td>
                                        <small>{{ sale.model.brand.name }} {{ sale.model.name }}</small>
                                    </td>
                                    <td class="text-success">PKR {{ "{:,}".format(sale.sale_price) }}</td>
                                    <td>
                                        {% if sale.payment_status == 'paid' %}
                                            <span class="badge bg-success">Paid</span>
                                        {% elif sale.payment_status == 'partial' %}
                                            <span class="badge bg-warning">Partial</span>
                                        {% else %}
                                            <span class="badge bg-danger">Pending</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-shopping-cart text-muted" style="font-size: 2rem;"></i>
                        <p class="text-muted mt-2">No recent sales</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Recent Purchases -->
        <div class="col-md-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-shopping-bag me-2"></i>
                        Recent Purchases
                    </h5>
                </div>
                <div class="card-body">
                    {% if recent_purchases %}
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead class="table-light">
                                <tr>
                                    <th>Date</th>
                                    <th>Device</th>
                                    <th>Qty</th>
                                    <th>Total</th>
                                    <th>Payment</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for purchase in recent_purchases %}
                                <tr>
                                    <td>{{ purchase.date.strftime('%d/%m') }}</td>
                                    <td>
                                        <small>{{ purchase.model.brand.name }} {{ purchase.model.name }}</small>
                                    </td>
                                    <td>
                                        <span class="badge bg-primary">{{ purchase.quantity }}</span>
                                    </td>
                                    <td class="text-danger">PKR {{ "{:,}".format(purchase.purchase_price * purchase.quantity) }}</td>
                                    <td>
                                        <span class="badge {% if purchase.payment_status == 'paid' %}bg-success{% elif purchase.payment_status == 'partial' %}bg-warning{% else %}bg-danger{% endif %}">
                                            {{ purchase.payment_status|title }}
                                        </span>
                                        <br>
                                        <small class="text-muted">
                                            {{ "{:,}".format(purchase.paid_amount) }}/{{ "{:,}".format(purchase.purchase_price * purchase.quantity) }}
                                        </small>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-shopping-bag text-muted" style="font-size: 2rem;"></i>
                        <p class="text-muted mt-2">No recent purchases</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Additional Tools -->
    <div class="row">
        <div class="col-12">
            <div class="card bg-light">
                <div class="card-body text-center">
                    <h6 class="text-muted mb-3">Additional Tools</h6>
                    <div class="d-flex justify-content-center gap-2 flex-wrap">
                        <a href="{{ url_for('search_device') }}" class="btn btn-outline-primary tool-btn" style="color: #0d6efd; border-color: #0d6efd; background-color: white;">
                            <i class="fas fa-search me-2"></i>
                            Search Device by IMEI
                        </a>
                        <a href="{{ url_for('brands') }}" class="btn btn-outline-info tool-btn" style="color: #0dcaf0; border-color: #0dcaf0; background-color: white;">
                            <i class="fas fa-tags me-2"></i>
                            Manage Brands & Models
                        </a>
                        <a href="{{ url_for('shops') }}" class="btn btn-outline-success tool-btn" style="color: #198754; border-color: #198754; background-color: white;">
                            <i class="fas fa-store me-2"></i>
                            Manage Shops
                        </a>
                        <a href="{{ url_for('incentives') }}" class="btn btn-outline-warning tool-btn" style="color: #fd7e14; border-color: #fd7e14; background-color: white;">
                            <i class="fas fa-gift me-2"></i>
                            Manage Incentives
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('profitTrendChart').getContext('2d');
const profitTrendChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: ['Jan 1', 'Jan 5', 'Jan 9', 'Jan 13', 'Jan 17', 'Jan 21', 'Jan 25'],
        datasets: [{
            label: 'Profit',
            data: [500, 900, 700, 1200, 950, 1300, 1500],
            borderColor: '#3ca97b',
            backgroundColor: 'rgba(60, 169, 123, 0.08)',
            tension: 0.4,
            pointRadius: 5,
            pointBackgroundColor: '#3ca97b',
            fill: true
        }]
    },
    options: {
        plugins: {
            legend: { display: false }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: { color: '#b0bfc6', font: { size: 13 } },
                grid: { color: '#e0e7e3' }
            },
            x: {
                ticks: { color: '#b0bfc6', font: { size: 13 } },
                grid: { display: false }
            }
        }
    }
});
</script>
{% endblock %} 